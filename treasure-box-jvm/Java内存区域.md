# 内存区域
## 运行时数据区域

![运行时数据区域](img/运行时数据区域.png)
- 线程私有
    - 程序计数器
        - 可以看做当前线程所执行的字节码的行号指示器
    - 虚拟机栈
        - 局部变量表
        - 操作数栈
        - 动态连接
        - 方法出口
    - 本地方法栈
- 线程共享
    - 堆
        - 垃圾收集器管理
        - 存储对象实例
    - 方法区
        - 存储类型信息、常量、静态变量、即时编译后的代码缓存
        - 运行时常量池: 存放编译期生成的各种字面量与符号引用
- 直接内存
    - 并不是虚拟机运行时数据区的一部分，也不是《Java虚拟机规范》中定义的内存区域。
    - NIO可以使用Native函数库直接分配堆外内存，然后通过一个存储在Java堆里面的DirectByteBuffer对象作为这块内存的引用进行操作

## HotSpot虚拟机对象
- 对象创建
    - 分配内存
        - 堆内存指针操作线程安全保证
            - CAS和失败重试，保证堆内存指针更新的原子性
            - 每个线程在堆中预先分配一小块内存（本地线程分配缓冲）
    - 初始化对象的字段（零值）
    - 设置对象头
    - 将对象引用入栈
- 对象的内存布局
    - 对象头（Header）
        - 对象运行时数据（Mark Word 32/64 bit）
            - HashCode
            - GC分代年龄
            - 锁状态标志
            - 线程持有的锁
            - 偏向线程ID
            - 偏向时间戳
        - 类型指针，指向对象的类型元数据
        - 数组长度（对象为数组时）
    - 实例数据（Instance Data）
    - 对齐填充（Padding）
        - 对象大小必须是8字节的整数倍
- 对象的访问定位
    - 句柄
        - 句柄池
    - 指针（HotSpot主要使用指针方式）
